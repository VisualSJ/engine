<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Panel Example</title>
    <style>
        body>section {
            font-family: -apple-system, BlinkMacSystemFont, Segoe WPC, Segoe UI, HelveticaNeue-Light, Noto Sans, Microsoft YaHei, PingFang SC, Hiragino Sans GB, Source Han Sans SC, Source Han Sans CN, Source Han Sans, sans-serif;
            margin: 15px;
        }

        h1 {
            margin: 0 0 15px 0;
        }
        h5 {
            overflow: hidden;
            height: 20px;
            line-height: 20px;
        }
    </style>
</head>

<body>

    <select id="select">
        <optgroup label="Controls">
            <option>ui-prop</option>
            <option>ui-color</option>
            <option>ui-num-input</option>
            <option>ui-slider</option>
            <option>ui-select</option>
            <option>ui-color-picker</option>
            <option>ui-checkbox</option>
            <option>ui-button</option>
            <option>ui-input</option>
            <option>ui-textarea</option>
        </optgroup>
        <optgroup label="Containers">
            <option>ui-section</option>
            <option>ui-drag</option>
        </optgroup>
        
        <optgroup label="Views">
            <option>ui-loading</option>
        </optgroup>
    </select>

    <section id="content">

    </section>

</body>
<script>
    const fs = require('fs');
    const ui = require('../index');
    const $select = document.getElementById('select');
    const $content = document.getElementById('content');
    const regScript = /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/; //验证script脚本的正则
    const eventNames = []; // 存储事件名
    let  _timer; // 存储定时器
    let changeTestPage = function (name) {
        let path = __dirname + '/element/' + name + '.html';
        let $scriptWrap = document.getElementById('scriptWrap');
        if ($scriptWrap) {
            document.body.removeChild($scriptWrap);
        }

        if (!fs.existsSync(path)) {
            $content.innerHTML = '';
            return;
        }
        let contentHtml = fs.readFileSync(path, 'utf-8');
        let scriptArr = contentHtml.match(regScript);
        if (scriptArr !== null) { //先判断文本内是否存在script标签           
            let scriptCodes = scriptArr[0].replace(/<\/?script>/g, ''); //提取标签内容
            contentHtml = contentHtml.replace(scriptArr[0], ''); //移除原html字符串中的script标签部分
            $content.innerHTML = contentHtml;
            //新建script标签，放置原本的script内容
            let $script = document.createElement('script');
            $script.id = 'scriptWrap';
            $script.innerHTML = scriptCodes;
            document.body.appendChild($script);
        } else {
            $content.innerHTML = contentHtml;
        }
    };
    changeTestPage($select.value);
    $select.addEventListener('change', (event) => {
        changeTestPage(event.target.value);
    });

    // 阻止默认打开文件事件
    window.addEventListener('dragover', event => {
    event.dataTransfer.dropEffect = 'none';
        event.preventDefault();
    });
    window.addEventListener('drop', event => {
        event.preventDefault();
    });

    function $ID(id) {
        return document.getElementById(id);
    }

    function $CLASS(name) {
        return document.getElementsByClassName(name);
    }

    // 基础事件的添加处理
    function addNormalEvent(eventArr, element, showEvent, showValue) {
        for (let i = 0, len = eventArr.length; i < len; i++) {
            element.addEventListener(eventArr[i], (event) => {
                console.log(eventArr[i]);
                if (showValue) {
                    showValue.innerHTML = event.target.value;
                }
                eventNames.push(eventArr[i]);
                showEvent.innerText = eventNames.toString();
                clearTimeout(_timer);
                _timer = setTimeout(() => {
                    showEvent.innerText = '';
                    eventNames.length = 0;
                }, 500)
            }, false)
        }
    }
</script>
</html>